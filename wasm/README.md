# Bstates with WebAssembly (WASM)

This module exports functions implemented in WebAssembly (WASM) to work with `bstates` from a Node.js backend or directly in a browser using JavaScript.

---

## Build and Test Dependencies

To build and test this project, you need the following:

1. [**Nix**](https://nixos.org/download/) with the flakes experimental feature enabled. See [Enabling flakes in Nix](#enabling-flakes-in-nix).  
   Nix ensures that the correct Go compiler is available to generate the `bstates.wasm` file. It also ensures that the tests run using a compatible version of Node.js.

2. **Node.js**: If Node.js is not installed on your system, you can use a Nix shell to make it available. See [Running a Nix Shell](#running-a-nix-shell).

3. **npm**: If npm is not installed on your system, you can also use a Nix shell to make it available.

---

### Enabling Flakes in Nix

If [flakes](https://nixos.wiki/wiki/Flakes) are not already enabled, you can enable them by modifying your Nix configuration file:


```bash
mkdir -p ~/.config/nix
echo 'experimental-features = nix-command flakes' >> ~/.config/nix/nix.conf
```

### Running a Nix Shell

To open a Nix shell with the required environment, run the following command from the root of the project or any subdirectory:

```bash
nix develop
```

## How to Build and Install Dependencies

To build the project and install all necessary dependencies, run:
```bash
npm install
```
This command:

1. Ensures the project is built (the `bstates.wasm` file is generated) by automatically opening a Nix shell.
2. Installs all JavaScript dependencies.

## How to Test

To execute the test suite:

```bash
npm test
```

This command:
1. Automatically opens a Nix shell to ensure the environment is correctly set up.
2. Runs all tests using Jest.

## Examples

All examples use and execute the function implemented in `example.js`.

### Running Examples

#### Node.js ES Module (ESM)

1. Navigate to the `examples/nodejs_es` directory:
   ```bash
   cd examples/nodejs_es
   ```
2. Install dependencies:
   ```bash
   npm install
   ```
3. Run the example:
   ```bash
   npm start
   ```

#### Node.js CommonJS (CJS)

1. Navigate to the `examples/nodejs_cjs` directory:
   ```bash
   cd examples/nodejs_cjs
   ```
2. Prepare and install dependencies:
   ```bash
   npm install
   ```
3. Run the example:
   ```bash
   npm start
   ```

#### Web Client

1. Navigate to the `examples/web` directory:
   ```bash
   cd examples/web
   ```
2. Prepare and install dependencies:
   ```bash
   npm install
   ```
3. Start the example:
   ```bash
   npm start
   ```
   This will:
      1. Start an HTTP server on port 8080.
      2. Automatically open index.html in your default web browser.
      3. The function defined in `example.js` is automatically called when the page is loaded.

4. Open the browser's developer console to view the output generated by the function defined in `example.js`.

5. Feel free to interact with the `bstates` API directly from the console.

---

### Additional Notes

- **API Documentation**: For details on how to use the `bstates` API, refer to the inline documentation in the `example.js` file.
- **Troubleshooting**: If you encounter issues, ensure you have both Node.js and npm installed, and that all dependencies have been properly installed.

Feel free to reach out if you encounter any issues or need further assistance!